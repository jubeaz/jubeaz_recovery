---
haproxy_certs:
  - name: haproxy
    bundle_path: /etc/haproxy/bundle
    bundle_name: bundle.pem
    cert_name: haproxy.pem
    cert_path: /etc/haproxy/cert
    key_name: haproxy.key
    key_path: /etc/haproxy/private
    cn: haproxy
    san:
      - ""
      - ""

haproxy_socket: /var/lib/haproxy/stats
haproxy_chroot: /var/lib/haproxy
#haproxy_unit_mount_name: var-lib-haproxy-dev-log.mount
haproxy_user: haproxy
haproxy_group: haproxy
haproxy_global_params: []
# Default haproxy timeouts
haproxy_connect_timeout: 5s
haproxy_client_timeout: 50s
haproxy_server_timeout: 50s

#########################################
# Frontend settings.
haproxy_frontends:
  - name: https_listener
    binds:
      - addr: 10.10.14.6
        port: 4443
        extra: "ssl crt /etc/haproxy/bundle/bundle.pem"
      - addr: 192.168.10.21
        port: 4443
        extra: "ssl crt /etc/haproxy/bundle/bundle.pem"
    firewall_allow: 
      - any
    mode: tcp
    options: [
#      option_1: "value",
#      option_2: "value"
    ]
    acl: {
#      is_https: "req.ssl_hello_type 1",
    }
    extra_params: {
#      default_backend: "backend_http_reject"
    }
    use_backends:
      - "backend_http"
  - name: https_listener
    binds:
      - addr: 10.10.14.6
        port: 880
      - addr: 192.168.10.21
        port: 880
#      - addr: 10.0.0.1
#        port: 880
#        extra: "ssl crt /etc/ssl/certs/haproxy.pem"
    firewall_allow: 
      - any
    mode: tcp
    options:
#      - name: tcp-request
#        value: inspect-delay 2s
#      - name: tcp-request
##        value: content accept if HTTP
#        value: content capture req.proto_http len 1
    acl: {
#      is_http: "HTTP",
      from_10net: "src 10.0.0.0/8",
      from_192net: "src 192.168.0.0/16"
    }
    extra_params: {
      default_backend: "backend_tcp_reject"
    }
    use_backends:
      - "backend_8871 if !is_http from_10net"
      - "backend_8870 if !is_http from_192net"
#  - name: mixed_listener
#    binds:
#      - addr: 10.10.14.6
#        port: 880
#      - addr: 192.168.10.21
#        port: 880
##      - addr: 10.0.0.1
##        port: 880
##        extra: "ssl crt /etc/ssl/certs/haproxy.pem"
#    firewall_allow: 
#      - any
#    mode: tcp
#    options:
#      - name: tcp-request
#        value: inspect-delay 2s
#      - name: tcp-request
##        value: content accept if HTTP
#        value: content capture req.proto_http len 1
#    acl: {
##      is_http: "HTTP",
#      from_10net: "src 10.0.0.0/8",
#      from_192net: "src 192.168.0.0/16"
#    }
#    extra_params: {
#      default_backend: "backend_reject"
#    }
#    use_backends:
#      - "backend_http if is_http"
#      - "backend_8871 if !is_http from_10net"
#      - "backend_8870 if !is_http from_192net"

# Backend settings.
haproxy_backends:
  - name: backend_http
    mode: http
    option: {
#      option_1: "value",
#      option_2: "value"
    }
    servers: {
      nginx1: "127.0.0.1:80"
    }
    extra_params: {
#      u: "value",
#      v: "value"
    }
  - name: backend_8870
    mode: tcp
    servers: {
      sl_debug: "127.0.0.1:8870"
    }
    option: {
    }
    extra_params: {
    }
  - name: backend_8871
    mode: tcp
    servers: {
      sl_prod: "127.0.0.1:8871"
    }
    option: {
    }
    extra_params: {
    }
  - name: backend_tcp_reject
    mode: tcp
    extra_params: {
#      errorfile: "503 /etc/haproxy/errors/503.http"
    }
    option: {
    }
    servers: {
    }
#  - name: backend_http_reject
#    mode: tcp
#    extra_params: {
##      errorfile: "503 /etc/haproxy/errors/503.http"
#    }
#    option: {
#    }
#    servers: {
#    }
